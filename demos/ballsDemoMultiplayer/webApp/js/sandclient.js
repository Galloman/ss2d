(function(){var f=!0,g=null,j=!1;function l(){return function(){}}function m(a,b){function c(){}c.prototype=b.prototype;a.Qa=b.prototype;a.prototype=new c};var n,q;
function r(a){this.o=a;a=a.j;a.style.outline="none";this.o.N=f;this.A=j;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))this.A=f;this.A||window.addEventListener("mousedown",s,f);window.addEventListener("keydown",t,f);window.addEventListener("keyup",t,f);a.addEventListener("mousedown",t,f);a.addEventListener("mouseup",t,f);a.addEventListener("mousemove",t,f);a.addEventListener("touchstart",t,j);a.addEventListener("touchend",
t,j);a.addEventListener("touchcancel",t,j);a.addEventListener("touchleave",t,j);this.aa={};this.G=this.F=-50;this.ja=this.ia=0;this.Y=j;this.Z=new u(this.F,this.G);this.xa=new u(this.ia,this.ja);this.V=this.Ja=j}r.prototype.H=function(){this.ia=this.F;this.ja=this.G;this.xa.p=this.ia;this.xa.q=this.ja;this.Ja=this.Y;this.Y=this.V};function t(a){n.X.handleEvent(a)}function s(){var a=n.X;a.o.N&&(a.o.N=j,a.V=j)}
r.prototype.handleEvent=function(a){var b=f;switch(a.type){case "mousedown":case "touchstart":b=this.A?window.event.targetTouches[0]:a;this.F=b.offsetX||b.pageX-this.o.j.offsetLeft;this.G=b.offsetY||b.pageY-this.o.j.offsetTop;this.Z.p=this.F;this.Z.q=this.G;if(this.A&&b||!this.A)this.V=this.o.N=f,a.preventDefault(),a.stopPropagation(),this.o.j.addEventListener("touchmove",t,j);b=j;break;case "mouseup":case "touchend":case "touchcancel":b=this.A?window.event.targetTouches[0]:a;if(this.A&&!b||!this.A)this.V=
this.Y=j,a.preventDefault(),a.stopPropagation(),this.o.j.removeEventListener("touchmove",t,j);b=j;break;case "keydown":this.o.N?(this.aa["_"+parseInt(a.keyCode)]=f,(37==a.keyCode||38==a.keyCode||39==a.keyCode||40==a.keyCode||32==a.keyCode)&&a.preventDefault(),b=j):b=f;break;case "keyup":this.o.N?(this.aa["_"+parseInt(a.keyCode)]=j,delete this.aa["_"+parseInt(a.keyCode)],b=j):b=f;break;case "mousemove":case "touchmove":if(a=this.A?window.event.targetTouches[0]:a)this.F=a.offsetX||a.pageX-this.o.j.offsetLeft,
this.G=a.offsetY||a.pageY-this.o.j.offsetTop,this.Z.p=this.F,this.Z.q=this.G;b=void 0}return b};r.prototype.toJSON=function(){var a;a="{"+('"keys":'+JSON.stringify(this.aa)+",");a+='"mx":'+this.F+",";a+='"my":'+this.G+",";a+='"md":'+this.Y;return a+"}"};var v=[],w=0;function x(a,b){a.prototype.sa=b;v[b]=a};function u(a,b){this.p=a;this.q=b}u.prototype.length=function(){return Math.sqrt(this.p*this.p+this.q*this.q)};function y(){this.f=1;this.i=this.g=0;this.k=1;this.n=this.m=0;this.La=Array(9)}y.prototype.toString=function(){return"(a="+this.f+", b="+this.g+", c="+this.i+", d="+this.k+", tx="+this.m+", ty="+this.n+")"};y.prototype.translate=function(a,b){this.m+=a;this.n+=b;return this};y.prototype.scale=function(a,b){this.f*=a;this.g*=b;this.i*=a;this.k*=b;this.m*=a;this.n*=b;return this};
y.prototype.rotate=function(a){var b=new y,c=-Math.sin(a),d=-Math.sin(a),e=Math.cos(a);b.f=-Math.cos(a);b.g=c;b.i=d;b.k=e;b.m=0;b.n=0;a=b.g*this.f+b.k*this.g;var c=b.f*this.i+b.i*this.k,d=b.g*this.i+b.k*this.k,e=b.f*this.m+b.i*this.n+1*b.m,h=b.g*this.m+b.k*this.n+1*b.n;this.f=b.f*this.f+b.i*this.g;this.g=a;this.i=c;this.k=d;this.m=e;this.n=h;delete b;return this};function z(a){this.v=a;this.va=new y}z.prototype.U=l();z.prototype.U=function(a){var b=this.va;b.f=1;b.g=0;b.i=0;b.k=1;b.m=0;b.n=0;b=(b=this.va)||new y;(0!=a.P||0!=a.R)&&b.translate(-a.P,-a.R);(0!=a.fa||0!=a.ga)&&b.translate(-a.fa,-a.ga);(1!=a.la||1!=a.ma)&&b.scale(a.la,a.ma);0!=a.ka&&b.rotate(a.ka);(0!=a.e.p||0!=a.e.q)&&b.translate(a.e.p,a.e.q);a=b;this.v.save();this.v.transform(a.f,a.g,a.i,a.k,a.m,a.n)};z.prototype.T=l();z.prototype.T=function(){this.v.restore()};function A(a,b){if(a){this.Ia=a;this.da=b;this.Oa=[];this.ha=this.C=this.ya=g;var c=new XMLHttpRequest;c.J=this;c.open("GET",a,f);c.responseType="arraybuffer";c.onload=function(){this.J.ya=q.createBuffer(this.response,j);c.J.da(this.J)};c.send()}}A.prototype.play=function(){var a=this.ha||q.createBufferSource();this.ha=g;a.buffer=this.ya;a.connect(q.destination);a.noteOn(0);return this.C=a};A.prototype.pause=function(){this.C&&(this.C.noteOff(0),this.ha=this.C)};
A.prototype.stop=function(){this.C&&(this.C.noteOff(0),this.C.disconnect(),this.C=g)};function B(){if(q)return q;if("undefined"!==typeof AudioContext)return new AudioContext;if("undefined"!==typeof webkitAudioContext)return new webkitAudioContext;console.log("AudioContext not supported");return g};function C(a,b,c,d,e,h){this.j=document.getElementById(a);this.v=this.j.getContext("2d");this.ba=j;this.Ga=d||60;this.X=new r(this);this.wa=(new Date).getTime();this.j.width=b||800;this.j.height=c||600;n=this;q=B();this.O=g;this.Ka=new z(this.v);this.Ea="#202020";this.l=[];this.W=g;this.Fa=h||100;this.Ha=e||20;window.wastedTimePerFrame=0}function D(){E(n)}function F(){G(n)}
function E(a){var b=(new Date).getTime(),c=b-a.wa;if(1<a.l.length){for(var d=b-a.Fa,e=-1,h=-1,k=0;k<a.l.length&&-1==h;k++){var H=a.l[k][0],I=a.l[k][1];H<d&&(e=k,I.PLAYSOUNDS!=g&&(I.PLAYSOUNDS=g,delete I.PLAYSOUNDS));H>=d&&(h=k)}if(-1!=e&&-1!=h){for(k=0;k<e;++k)J(a,k,e,d);J(a,e,h,d)}a.l.splice(0,e);a.v.fillStyle=a.Ea;a.v.fillRect(0,0,a.j.width,a.j.height);a.O!=g&&a.O.K(a.Ka)}a.X.H(c/1E3);a.wa=b;b=Math.max(0,1/a.Ga-((new Date).getTime()-b)/1E3);a.ba&&setTimeout(D,1E3*b)}
function G(a){var b=a.W;if(b.M){var c='["UINPUT",'+a.X.toJSON()+"]";b.B.send(c)}a.ba&&setTimeout(F,1E3*(1/a.Ha))}function J(a,b,c,d){var e=a.l[b][0];d=(d-e)/(a.l[c][0]-e);a.O==g&&(a.O=v[a.l[b][1].cid].createFromSerializedObject(a.l[b][1]),console.debug("main scene created"));a.O.t(a.l[b][1],a.l[c][1],d)}C.prototype.Aa=l();C.prototype.Ba=l();C.prototype.pa=l();function K(a){if(a instanceof K)this.b=a.b.slice(0);else if(a instanceof Array&&2<a.length)this.b=a.slice(0);else if("string"==typeof a||"number"==typeof a)"string"==typeof a&&(a=parseInt("0x"+a.replace("#","").substring(0,6))),a&=16777215,this.b=[(a&16711680)>>16,(a&65280)>>8,a&255]}function L(a){var b=Math.floor(a.b[0]).toString(16),b=1==b.length?"0"+b:b,c=Math.floor(a.b[1]).toString(16),c=1==c.length?"0"+c:c;a=Math.floor(a.b[2]).toString(16);a=1==a.length?"0"+a:a;return"#"+b+c+a}
function M(a,b,c){a=new K(a);b=new K(b);a.b[0]+=(b.b[0]-a.b[0])*c;a.b[1]+=(b.b[1]-a.b[1])*c;a.b[2]+=(b.b[2]-a.b[2])*c;delete b;return a};function N(a,b,c,d,e,h){this.e=new u(a||0,b||0);this.ka=d||0;this.R=this.P=0;this.la=c||1;this.ma=c||1;this.$=g;this.Na=j;this.ga=this.fa=0;this.D=e instanceof K?e:new K(e||16777215);this.Da=h||1;this.z=w++}x(N,1001);N.prototype.H=l();N.prototype.K=l();N.createFromSerializedObject=function(a){var b=new N(a.x,a.y,a.s,a.r,a.c);b.z=a.doid;return b};
N.prototype.t=function(a,b,c,d){this.e.p=a.x+(b.x-a.x)*c;this.e.q=a.y+(b.y-a.y)*c;this.ka=a.r+(b.r-a.r)*c;this.P=a.px+(b.px-a.px)*c;this.R=a.py+(b.py-a.py)*c;this.la=a.sx+(b.sx-a.sx)*c;this.ma=a.sy+(b.sy-a.sy)*c;this.fa=a.ox+(b.ox-a.ox)*c;this.ga=a.oy+(b.oy-a.oy)*c;var e;e=M(a.c,b.c,c).b;var h=this.D,k=e[1],H=e[2];h.b[0]=e[0];h.b[1]=k;h.b[2]=H;this.Da=a.a+(b.a-a.a)*c;b=a.snds;if(b!=g){for(var I in b){b=a.snds[childIndex];try{O[b+".sound"]||(O[b+".sound"]=new P(b,void 0)),O[b+".sound"].play()}catch(aa){}}delete a.snds}this.H&&
this.H(d)};function Q(a,b,c,d,e){N.call(this,a,b,1,0,e,1);this.oa=c||10;this.ea=d||10}m(Q,N);x(Q,1003);Q.prototype.K=function(a){a.U(this);var b=a.v;b.fillStyle=L(this.D);b.rect(0,0,this.oa,this.ea);a.T()};Q.createFromSerializedObject=function(a){var b=new Q(a.x,a.y,a.w,a.h,a.c);b.z=a.doid;return b};Q.prototype.t=function(a,b,c,d){N.prototype.t.call(this,a,b,c,d);this.oa=a.w+(b.w-a.w)*c;this.ea=a.h+(b.h-a.h)*c};function R(a,b,c,d){Q.call(this,a,b,2*c,2*c,d);this.P=this.R=this.S=c}m(R,Q);x(R,3001);R.createFromSerializedObject=function(a){var b=new R(a.x,a.y,a.rd,a.c);b.z=a.doid;return b};R.prototype.t=function(a,b,c){this.e.p=a.x+(b.x-a.x)*c;this.e.q=a.y+(b.y-a.y)*c;this.P=this.R=this.S=a.rd+(b.rd-a.rd)*c;a=M(a.c,b.c,c).b;b=this.D;c=a[1];var d=a[2];b.b[0]=a[0];b.b[1]=c;b.b[2]=d};
R.prototype.K=function(a){a.U(this);var b=a.v;b.fillStyle=L(this.D);b.beginPath();b.arc(this.S,this.S,this.S,0,2*Math.PI,f);b.closePath();b.fill();a.T()};R.prototype.toJSON=function(){return"{"+this.ca()+"}"};R.prototype.ca=function(){var a='"cid":'+this.sa+",",a=a+('"doid":'+this.z+","),a=a+('"x":'+Math.floor(1E3*this.e.p)/1E3+","),a=a+('"y":'+Math.floor(1E3*this.e.q)/1E3+","),a=a+('"rd":'+this.S+",");return a+='"c":'+JSON.stringify(this.D.b)};function S(a,b){this.Ia=a;this.u=new Audio;this.u.J=this;this.u.Pa=f;(this.u.da=b)&&this.u.addEventListener("canplay",function(){this.da.call(g,this.J)});this.u.addEventListener("ended",function(){this.J.stop()});this.u.src=a}S.prototype.play=function(){this.u.play();return this};S.prototype.pause=function(){this.u.pause()};S.prototype.stop=function(){this.u.pause();this.u.currentTime=0};var O={},P=S;if("undefined"!=typeof webkitAudioContext||"undefined"!=typeof AudioContext)P=A;function T(a,b,c,d){N.call(this,a,b,c,d);this.d=[]}m(T,N);x(T,1002);T.prototype.H=function(a){for(var b in this.d)this.d[b].H&&this.d[b].H(a)};T.prototype.K=function(a){a.U(this);for(var b in this.d)this.d[b].K(a);a.T()};function U(a,b){if(b instanceof Array)for(var c in b)U(a,b[c]);else b instanceof N&&(b.$&&V(b.$,b),b.$=a,a.d.push(b))}function V(a,b){if(b instanceof Array)for(var c in b)V(a,b[c]);else c=a.d.indexOf(b),-1!=c&&a.d.splice(c,1),b.$=g}
T.createFromSerializedObject=function(a){var b=new T(a.x,a.y);b.z=a.doid;return b};T.prototype.t=function(a,b,c,d,e){e||N.prototype.t.call(this,a,b,c,d);a=a.clist;d=b.clist;e=b.rmobjts;for(b=0;b<this.d.length&&0<e.length;++b){var h=this.d[b];-1!=e.indexOf(h.z)&&(V(this,h),delete a.splice(b,1)[0],e.splice(e.indexOf(h.z),1),delete h)}for(b=this.d.length;b<a.length;++b)e=v[a[b].cid].createFromSerializedObject(a[b]),U(this,e);for(b=0;b<this.d.length;++b)a[b]&&d[b]?this.d[b].t(a[b],d[b],c):V(this,this.d[b])};function W(){T.call(this);this.Ma=g}m(W,T);x(W,1006);W.prototype.t=function(a,b,c,d){T.prototype.t.call(this,a,b,c,d,f)};var X={Ca:60,ra:800,qa:600,ta:"localhost",ua:0,Ca:60,ra:768,qa:432,ta:"niutek.net",ua:51137};function Y(a){Q.call(this,0,0,5,5,16777215);this.B=a||g;this.na=""}m(Y,Q);x(Y,3003);Y.createFromSerializedObject=function(a){var b=new Y;b.z=a.doid;return b};Y.prototype.t=function(a,b,c){this.e.p=a.x+(b.x-a.x)*c;this.e.q=a.y+(b.y-a.y)*c;this.na=b.uname};Y.prototype.K=function(a){a.U(this);var b=a.v;b.fillStyle=L(this.D);b.fillRect(0,0,this.oa,this.ea);b.font="normal 12px Verdana";b.fillText(this.na,-5,-10);a.T()};Y.prototype.toJSON=function(){return"{"+this.ca()+"}"};
Y.prototype.ca=function(){var a='"cid":'+this.sa+",",a=a+('"doid":'+this.z+","),a=a+('"x":'+Math.floor(this.e.p)+","),a=a+('"y":'+Math.floor(this.e.q)+",");return a+='"uname":"'+this.na+'"'};function Z(){W.call(this)}m(Z,W);x(Z,3002);Z.createFromSerializedObject=function(a){var b=new Z;b.z=a.doid;return b};var $=new C("mainScene",X.ra,X.qa,60,20,100);$.Aa=function(){for(var a="";a!=g&&3>a.length;)a=window.prompt("Your name? (3 characters min)");if(a){var b=$.W;b.M&&b.B.send('["UNAME","'+a+'"]')}};$.pa=function(a,b){switch(a){case "REJECTED":alert(b),$.za=f}};$.Ba=function(){("undefined"==typeof $.za||!$.za)&&alert("Disconnected")};
$.W=new function(a,b,c){this.L=a;this.B=new WebSocket("ws://"+b+":"+c+"/");this.B.I=this;this.M=j;this.B.onopen=function(){console.log("WebSocket connected");this.I.M=f;this.I.L.Aa(this)};this.B.onerror=function(a){console.log("WebSocket Error "+a);this.I.M=j};this.B.onclose=function(){this.I.M=j;this.I.L.Ba(this)};this.B.onmessage=function(a){var b=this.I,c=JSON.parse(a.data),k=c[0],c=c[1];switch(k){case "SCENE":b.L.l.push([(new Date).getTime(),c]);break;case "REJECTED":b.L.pa(k,c,this);break;default:b.L.pa(k,
c,this)}delete a.data}}($,X.ta,X.ua);!$.ba&&$.W!=g&&($.ba=f,E($),G($));})();
