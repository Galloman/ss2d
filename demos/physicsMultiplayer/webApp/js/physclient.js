(function(){var h=!0,j=null,k=!1;function l(){return function(){}}function m(b,c){function d(){}d.prototype=c.prototype;b.gb=c.prototype;b.prototype=new d};var n,q;function r(b){if(b instanceof r)this.b=b.b.slice(0);else if(b instanceof Array&&2<b.length)this.b=b.slice(0);else if("string"==typeof b||"number"==typeof b)"string"==typeof b&&(b=parseInt("0x"+b.replace("#","").substring(0,6))),b&=16777215,this.b=[(b&16711680)>>16,(b&65280)>>8,b&255]}function u(b){var c=Math.floor(b.b[0]).toString(16),c=1==c.length?"0"+c:c,d=Math.floor(b.b[1]).toString(16),d=1==d.length?"0"+d:d;b=Math.floor(b.b[2]).toString(16);b=1==b.length?"0"+b:b;return"#"+c+d+b};function v(b,c){this.e=b;this.f=c}v.prototype.length=function(){return Math.sqrt(this.e*this.e+this.f*this.f)};function w(){this.j=1;this.l=this.k=0;this.m=1;this.q=this.p=0;this.cb=Array(9)}w.prototype.ma=function(b,c,d,g,e,f){this.j=b;this.k=c;this.l=d;this.m=g;this.p=e;this.q=f};w.prototype.toString=function(){return"(a="+this.j+", b="+this.k+", c="+this.l+", d="+this.m+", tx="+this.p+", ty="+this.q+")"};w.prototype.translate=function(b,c){this.p+=b;this.q+=c;return this};w.prototype.scale=function(b,c){this.j*=b;this.k*=c;this.l*=b;this.m*=c;this.p*=b;this.q*=c;return this};
w.prototype.rotate=function(b){var c=new w;c.ma(Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0);this.ma(c.j*this.j+c.l*this.k,c.k*this.j+c.m*this.k,c.j*this.l+c.l*this.m,c.k*this.l+c.m*this.m,c.j*this.p+c.l*this.q+1*c.p,c.k*this.p+c.m*this.q+1*c.q);delete c;return this};var x=[],aa=0;function y(b,c){b.prototype.Ma=c;x[c]=b};function z(b,c,d,g,e,f){this.d=new v(b||0,c||0);this.aa=g||0;this.ka=this.ja=0;this.F=d||1;this.K=d||1;this.ia=j;this.V=e instanceof r?e:new r(e||16777215);this.pa=f||1;this.z=aa++}y(z,1001);function A(b,c){c=c||new w;(0!=b.ja||0!=b.ka)&&c.translate(-b.ja,-b.ka);(1!=b.F||1!=b.K)&&c.scale(b.F,b.K);0!=b.aa&&c.rotate(b.aa);(0!=b.d.e||0!=b.d.f)&&c.translate(b.d.e,b.d.f);return c}z.prototype.C=l();z.prototype.v=l();z.createFromSerializedObject=function(b){var c=new z(b.x,b.y,b.s,b.r,b.c);c.z=b.doid;return c};
z.prototype.n=function(b,c,d,g){this.d.e=b.x?b.x+(c.x-b.x)*d:this.d.e;this.d.f=b.y?b.y+(c.y-b.y)*d:this.d.f;this.aa=b.r?b.r+(c.r-b.r)*d:this.aa;this.ja=b.px?b.px+(c.px-b.px)*d:this.ja;this.ka=b.py?b.py+(c.py-b.py)*d:this.ka;this.F=b.sx?b.sx+(c.sx-b.sx)*d:this.F;this.K=b.sy?b.sy+(c.sy-b.sy)*d:this.K;if(b.c){var e=c.c,f=new r(b.c),e=new r(e);f.b[0]+=(e.b[0]-f.b[0])*d;f.b[1]+=(e.b[1]-f.b[1])*d;f.b[2]+=(e.b[2]-f.b[2])*d;delete e;var f=f.b,e=this.V,s=f[1],t=f[2];e.b[0]=f[0];e.b[1]=s;e.b[2]=t}this.pa=b.a?
b.a+(c.a-b.a)*d:this.pa;c=b.snds;if(c!=j){for(var U in c){c=b.snds[childIndex];try{B(C,c).play()}catch(O){}}delete b.snds}this.C&&this.C(g)};function D(b,c,d,g,e){z.call(this,b,c,1,0,e,1);this.S=d||10;this.N=g||10}m(D,z);y(D,1003);D.prototype.v=function(b){b.M(this);var c=b.o;c.fillStyle=u(this.V);c.fillRect(0,0,this.S,this.N);b.L()};D.createFromSerializedObject=function(b){var c=new D(b.x,b.y,b.w,b.h,b.c);c.z=b.doid;return c};D.prototype.n=function(b,c,d,g){z.prototype.n.call(this,b,c,d,g);this.S=b.w?b.w+(c.w-b.w)*d:this.S;this.N=b.h?b.h+(c.h-b.h)*d:this.N};function E(b,c){this.Z=b;this.ca=new Image;this.ca.B=this;this.T=c||l();this.ca.onload=function(){var b=this.B;b.T.call(j,b)};this.ca.src=b};function ba(b,c){this.Z=b;this.T=c;this.B=this.da=j;var d=new XMLHttpRequest;d.Oa=this;d.open("GET",b,h);d.responseType="text";d.onload=function(){var b=this.Oa;b.da=JSON.parse(this.response);var c=b.Z.lastIndexOf("/")+1,d=b.da.meta.image;b.B=new E(0<c?b.Z.substring(0,c)+d:d,b.T)};d.send()};var ca={na:"atlas",oa:function(b,c){return new ba(b,c)}};var F={na:"texture",oa:function(b,c){return new E(b,c)}};var C={};C.ya={}.ab;if("undefined"!=typeof webkitAudioContext||"undefined"!=typeof AudioContext)C.ya=G;C.na="sound";C.oa=function(b,c){return new C.ya(b,c)};var H={};function B(b,c){var d=c+"."+b.na;H[d]||(H[d]=b.oa(c,void 0));return H[d]};function I(b,c,d,g,e,f){D.call(this,b,c,d,g);"string"==typeof f?f=B(ca,f):"string"==typeof e&&!f&&(e=B(F,e));this.ba=f||j;this.B=e||j;this.G=[]}m(I,D);y(I,1004);
I.prototype.v=function(b){var c=j;if(this.ba){if(this.ba.B&&this.ba.da){var c=this.ba.B.ca,d=this.G,d=d||[],g=this.ba.da.frames[this.B].frame;g&&(d[0]=g.x,d[1]=g.y,d[2]=g.w,d[3]=g.h)}}else c=this.B.ca;b.M(this);d=b.o;c&&(3<this.G.length?d.drawImage(c,this.G[0],this.G[1],this.G[2],this.G[3],0,0,this.S,this.N):d.drawImage(c,0,0,this.S,this.N));b.L()};I.createFromSerializedObject=function(b){var c=new I(b.x,b.y,b.w,b.h,b.t,b.c);c.z=b.doid;return c};
I.prototype.n=function(b,c,d,g){D.prototype.n.call(this,b,c,d,g);this.B=b.t&&b.t!=this.B.Z?B(F,b.t):this.B;this.G=b.clip||this.G};function J(b,c){I.call(this,b,c,40,40,"textures/crate0.png")}m(J,I);y(J,3001);J.createFromSerializedObject=function(b){var c=new J;c.z=b.doid;return c};function K(b,c,d,g){z.call(this,b,c,d,g);this.i=[]}m(K,z);y(K,1002);K.prototype.C=function(b){L(this,b)};function L(b,c){for(var d in b.i)b.i[d].C&&b.i[d].C(c)}K.prototype.v=function(b){b.M(this);for(var c in this.i)this.i[c].v(b);b.L()};function M(b,c){if(c instanceof Array)for(var d in c)M(b,c[d]);else c instanceof z&&(c.ia&&N(c.ia,c),c.ia=b,b.i.push(c))}function N(b,c){if(c instanceof Array)for(var d in c)N(b,c[d]);else d=b.i.indexOf(c),-1!=d&&b.i.splice(d,1),c.ia=j}
K.createFromSerializedObject=function(b){var c=new K(b.x,b.y);c.z=b.doid;return c};K.prototype.n=function(b,c,d,g,e){e||z.prototype.n.call(this,b,c,d,g);b=b.clist;g=c.clist;e=c.rmobjts;for(c=0;c<this.i.length&&0<e.length;++c){var f=this.i[c];-1!=e.indexOf(f.z)&&(N(this,f),delete b.splice(c,1)[0],e.splice(e.indexOf(f.z),1),delete f)}for(c=this.i.length;c<b.length;++c)e=x[b[c].cid].createFromSerializedObject(b[c]),M(this,e);for(c=0;c<this.i.length;++c)b[c]&&g[c]?this.i[c].n(b[c],g[c],d):N(this,this.i[c])};function P(){K.call(this);this.eb=j}m(P,K);y(P,1006);P.prototype.n=function(b,c,d,g){K.prototype.n.call(this,b,c,d,g,h);this.C&&this.C(g)};var Q={$a:60,Za:800,Ya:600,za:"localhost",Aa:0};Q.Na=60;Q.bb=35;Q.za="niutek.net";Q.Aa=51E3;function R(b,c,d,g,e,f,s){D.call(this,b,c,0,0,g);this.va=d||"";this.ra=e||16;this.Ca=f||"Verdana";this.Da=s||"normal";this.qa=-1}m(R,D);y(R,1007);R.prototype.v=function(b){b.M(this);var c=b.o;c.font=this.Da+" "+this.ra+"px "+this.Ca;c.fillStyle=u(this.V);var d=this.va;-1<this.qa&&(d=this.va.substring(0,this.qa));c.fillText(d,0,this.ra);b.L()};R.createFromSerializedObject=function(b){var c=new R(b.x,b.y,b.str,b.c,b.fsize,b.fname,b.fstyle);c.z=b.doid;return c};
R.prototype.n=function(b,c,d){D.prototype.n.call(this,b,c,d,deltaTime);this.va=b.str;this.ra=b.fsize;this.Ca=b.fname;this.Da=b.fstyle;this.qa=Math.floor(b.dc+(c.dc-b.dc)*d)};function S(b){D.call(this,0,0,5,5,16777215);this.H=b||j;this.wa=""}m(S,D);y(S,3003);S.createFromSerializedObject=function(b){var c=new S;c.z=b.doid;return c};S.prototype.n=function(b,c,d){this.d.e=b.x+(c.x-b.x)*d;this.d.f=b.y+(c.y-b.y)*d;this.wa=c.uname};S.prototype.v=function(b){b.M(this);var c=b.o;c.fillStyle=u(this.V);c.fillRect(0,0,this.S,this.N);c.font="normal 12px Verdana";c.fillText(this.wa,-5,-10);b.L()};
S.prototype.toJSON=function(){var b='"cid":'+this.Ma+",",b=b+('"doid":'+this.z+","),b=b+('"x":'+Math.floor(this.d.e)+","),b=b+('"y":'+Math.floor(this.d.f)+","),b=b+('"uname":"'+this.wa+'"');return"{"+b+"}"};function T(){P.call(this);this.Ua=new K;this.Va=new K;this.ga=new K;M(this.ga,new R(20,20,"Press W, A, S, or D to move.","#ffffff",18));M(this.ga,new R(20,40,"Press Z or X to zoom in or out your viewport.","#ffffff",18));M(this.ga,new R(20,60,"Click our toch an object to move it.","#ffffff",18))}m(T,P);y(T,3002);T.createFromSerializedObject=function(b){var c=new T;c.z=b.doid;return c};
T.prototype.C=function(b){L(this,b);var c=n.Y;V(c,da)&&(this.d.e-=200*b);V(c,ea)&&(this.d.e+=200*b);V(c,fa)&&(this.d.f+=200*b);V(c,ga)&&(this.d.f-=200*b);V(c,ha)&&(this.K=this.F+=0.5*b);V(c,ia)&&(this.K=this.F-=0.5*b);V(c,ja)&&(this.d.e=0,this.aa=this.d.f=0,this.K=this.F=1)};T.prototype.v=function(b){b.M(this);this.Ua.v(b);for(var c in this.i)this.i[c].v(b);this.Va.v(b);b.L();this.ga.v(b)};function W(b){this.u=b;b=b.g;b.style.outline="none";this.u.X=h;this.D=k;if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))this.D=h;this.D||(window.navigator.msPointerEnabled?window.addEventListener("MSPointerDown",ka,h):window.addEventListener("mousedown",ka,h));window.addEventListener("keydown",X,h);window.addEventListener("keyup",X,h);window.navigator.msPointerEnabled?(a.addEventListener("MSPointerDown",
X,h),a.addEventListener("MSPointerUp",X,h),a.addEventListener("MSPointerMove",X,h)):(b.addEventListener("mousedown",X,h),b.addEventListener("mouseup",X,h),b.addEventListener("mousemove",X,h));b.addEventListener("touchstart",X,k);b.addEventListener("touchend",X,k);b.addEventListener("touchcancel",X,k);b.addEventListener("touchleave",X,k);this.$={};this.R=this.P=-50;this.ta=this.sa=0;this.ha=k;this.J=new v(this.P,this.R);this.Ga=new v(this.sa,this.ta);this.ea=this.Wa=k}
var ea=65,da=68,ja=82,ga=83,fa=87,ia=88,ha=90;W.prototype.C=function(){this.sa=this.P;this.ta=this.R;this.Ga.e=this.sa;this.Ga.f=this.ta;this.Wa=this.ha;this.ha=this.ea};function X(b){n.Y.handleEvent(b)}function ka(){var b=n.Y;b.u.X&&(b.u.X=k,b.ea=k)}
W.prototype.handleEvent=function(b){var c=h;switch(b.type){case "mousedown":case "touchstart":case "MSPointerDown":c=this.D?window.event.targetTouches[0]:b;this.P=c.offsetX||c.pageX-this.u.g.offsetLeft;this.R=c.offsetY||c.pageY-this.u.g.offsetTop;this.J.e=this.P;this.J.f=this.R;if(this.D&&c||!this.D)this.ea=this.u.X=h,b.preventDefault(),b.stopPropagation(),this.u.g.addEventListener("touchmove",X,k);c=k;break;case "mouseup":case "touchend":case "touchcancel":case "MSPointerUp":c=this.D?window.event.targetTouches[0]:
b;if(this.D&&!c||!this.D)this.ea=this.ha=k,b.preventDefault(),b.stopPropagation(),this.u.g.removeEventListener("touchmove",X,k);c=k;break;case "keydown":this.u.X?(this.$["_"+parseInt(b.keyCode)]=h,(37==b.keyCode||38==b.keyCode||39==b.keyCode||40==b.keyCode||32==b.keyCode)&&b.preventDefault(),c=k):c=h;break;case "keyup":this.u.X?(this.$["_"+parseInt(b.keyCode)]=k,delete this.$["_"+parseInt(b.keyCode)],c=k):c=h;break;case "mousemove":case "touchmove":case "MSPointerMove":if(b=this.D?window.event.targetTouches[0]:
b)this.P=b.offsetX||b.pageX-this.u.g.offsetLeft,this.R=b.offsetY||b.pageY-this.u.g.offsetTop,this.J.e=this.P,this.J.f=this.R;c=void 0}return c};function V(b,c){return b.$["_"+c]!=j?h:k}
W.prototype.toJSON=function(){var b;if(n.I instanceof K){b=A(n.I);var c=b.j*b.m-b.l*b.k;b.ma(b.m/c,-b.k/c,-b.l/c,b.j/c,(b.l*b.q-b.m*b.p)/c,(b.k*b.p-b.j*b.q)/c);var c=this.J,d;d||(d=new v(0,0));var g=c.e;d.e=b.j*c.e+b.l*c.f+b.p;d.f=b.k*g+b.m*c.f+b.q;b=d}else b=this.J;if(isNaN(b.e)||isNaN(b.f))b=this.J;d="{"+('"keys":'+JSON.stringify(this.$)+",");d+='"mx":'+b.e+",";d+='"my":'+b.f+",";d+='"md":'+this.ha;return d+"}"};function Y(b){this.o=b;this.Ba=new w}Y.prototype.M=l();Y.prototype.M=function(b){this.Ba.ma(1,0,0,1,0,0);var c=A(b,this.Ba);this.o.save();this.o.globalAlpha*=b.pa;this.o.transform(c.j,c.k,c.l,c.m,c.p,c.q)};Y.prototype.L=l();Y.prototype.L=function(){this.o.restore()};function G(b,c){if(b){this.Z=b;this.T=c;this.fb=[];this.Fa=this.Ta=this.Ha=j;var d=new XMLHttpRequest;d.ua=this;d.open("GET",b,h);d.responseType="arraybuffer";d.onload=function(){this.ua.Ha=q.createBuffer(this.response,k);this.ua.T(this.ua)};d.send()}}G.prototype.play=function(){var b=this.Fa||q.createBufferSource();this.Fa=j;b.buffer=this.Ha;b.connect(q.destination);b.noteOn(0);return this.Ta=b};
function la(){if(q)return q;if("undefined"!==typeof AudioContext)return new AudioContext;if("undefined"!==typeof webkitAudioContext)return new webkitAudioContext;console.log("AudioContext not supported");return j};function Z(b,c,d,g,e,f){this.g=document.getElementById(b);this.o=this.g.getContext("2d");this.la=k;this.Ra=g||60;this.Y=new W(this);this.Ea=(new Date).getTime();this.g.width=c||this.g.height;this.g.height=d||this.g.height;n=this;q=la();this.I=j;this.Xa=new Y(this.o);this.Pa="#202020";this.A=[];this.fa=j;this.Qa=f||100;this.Sa=e||20;window.wastedTimePerFrame=0}function ma(){na(n)}function oa(){pa(n)}
function na(b){var c=(new Date).getTime(),d=c-b.Ea;b.La(b.g.width,b.g.height);for(var g=d/1E3,e=c-b.Qa,f=-1,s=-1,t=0;t<b.A.length&&-1==s;t++){var U=b.A[t][0],O=b.A[t][1];U<e&&(f=t,O.PLAYSOUNDS!=j&&(O.PLAYSOUNDS=j,delete O.PLAYSOUNDS));U>=e&&(s=t)}if(-1!=f&&-1!=s){for(t=0;t<f;++t)qa(b,t,f,e,g);qa(b,f,s,e,g)}b.A.splice(0,f);b.o.fillStyle=b.Pa;b.o.fillRect(0,0,b.g.width,b.g.height);b.I!=j&&b.I.v(b.Xa);b.Y.C(d/1E3);b.Ea=c;c=Math.max(0,1/b.Ra-((new Date).getTime()-c)/1E3);b.la&&setTimeout(ma,1E3*c)}
function pa(b){var c=b.fa;if(c.W){var d='["UINPUT",'+b.Y.toJSON()+"]";c.H.send(d)}b.la&&setTimeout(oa,1E3*(1/b.Sa))}function qa(b,c,d,g,e){var f=b.A[c][0];g=(g-f)/(b.A[d][0]-f);b.I==j&&(b.I=x[b.A[c][1].cid].createFromSerializedObject(b.A[c][1]),console.debug("main scene created"));b.I.n(b.A[c][1],b.A[d][1],g,e)}Z.prototype.La=l();Z.prototype.Ja=l();Z.prototype.Ka=l();Z.prototype.xa=l();var $=new Z("mainScene",window.innerWidth,window.innerHeight,Q.Na,30,120);$.La=function(){this.g.width=window.innerWidth;this.g.height=window.innerHeight};$.Ja=function(){for(var b="";b!=j&&3>b.length;)b=window.prompt("Your name? (3 characters min)");if(b){var c=$.fa;c.W&&c.H.send('["UNAME","'+b.substring(0,8)+'"]')}};$.xa=function(b,c){switch(b){case "REJECTED":alert(c),$.Ia=h}};$.Ka=function(){("undefined"==typeof $.Ia||!$.Ia)&&alert("Disconnected")};
$.fa=new function(b,c,d){this.U=b;this.H=new WebSocket("ws://"+c+":"+d+"/");this.H.O=this;this.W=k;this.H.onopen=function(){console.log("WebSocket connected");this.O.W=h;this.O.U.Ja(this)};this.H.onerror=function(b){console.log("WebSocket Error "+b);this.O.W=k};this.H.onclose=function(){this.O.W=k;this.O.U.Ka(this)};this.H.onmessage=function(b){var c=this.O,d=JSON.parse(b.data),s=d[0],d=d[1];switch(s){case "SCENE":c.U.A.push([(new Date).getTime(),d]);break;case "REJECTED":c.U.xa(s,d,this);break;default:c.U.xa(s,
d,this)}delete b.data}}($,Q.za,Q.Aa);!$.la&&$.fa!=j&&($.la=h,na($),pa($));})();
